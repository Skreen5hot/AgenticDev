# .github/workflows/ci.yml

name: CI, Security & Preview Deploy

on:
  push:
    branches: [ "**" ] 
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm install
      - name: Run tests
        run: npm test
      - name: Run security audit
        run: npm run security-check

---

  deploy:
    # ðŸŽ¯ FIX: NO IF STATEMENT HERE - The job will ALWAYS be scheduled and visible.
    needs: build-and-test
    runs-on: ubuntu-latest
    # Permissions and environment are optional since we aren't deploying, 
    # but we keep them for context.
    permissions:
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Log Current Branch
        run: echo "Starting deployment check on branch: ${{ github.ref_name }}"

      # --- ðŸ”‘ THE KEY PROOF STEP ---
      - name: Conditional DEV Deployment Action
        # This step ONLY runs if the branch is exactly 'dev'
        if: github.ref == 'refs/heads/dev'
        run: |
          echo "################################################################"
          echo "## LOGIC SUCCESS: This is the DEV branch. Actual deployment code would execute here."
          echo "## BASE PATH: /${{ github.ref_name }}/"
          echo "################################################################"
          # The actual deployment code (configure-pages, upload, deploy) would go here.
          
      - name: Conditional MAIN Deployment Action
        # This step ONLY runs if the branch is exactly 'main'
        if: github.ref == 'refs/heads/main'
        run: |
          echo "################################################################"
          echo "## LOGIC SUCCESS: This is the MAIN branch. Actual deployment code would execute here."
          echo "## BASE PATH: /"
          echo "################################################################"
          # The actual deployment code (configure-pages, upload, deploy) would go here.
